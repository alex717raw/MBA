---
description: 
globs: 
alwaysApply: false
---
---
description: Правила экономии батареи для GPS, фоновых задач и менеджмента процессов
globs: ["**/gps/**", "**/*Tracker*.swift", "**/*Tracker*.kt"]
alwaysApply: false
---

## Адаптивный GPS
- Переключать интервал `CLLocationManager` / `FusedLocationProvider` динамически:
  - 1 с при скорости > 3 м/с
  - 5 с при 0.5–3 м/с
  - 30 с при скорости < 0.5 м/с
- Кешировать последний фикс; если точность изменилась < 5 м, повторно использовать без нового запроса.

## Режим сверхэкономии
- Профиль `PowerProfile`; когда заряд ≤ 15 %:
  - Интервал выборки 60 с
  - Отключить фоновые загрузки карт
  - Ограничить частоту экрана до 30 Гц (Android) / `CADisplayLink.preferredFrameRateRange`

## Телеметрия
- Отправлять метрику `energy_usage` каждые 10 мин; загружать только по Wi-Fi или при зарядке.

## Процесс-менеджмент в режиме энергосбережения
1. **Строгий контроль процессов**  
   При активации Battery Saver все процессы приложения переводятся под управление системных API (`JobScheduler` / `BackgroundTasks`) и собственных «наблюдателей»; самовольная активность запрещена.
2. **Изолируемость и отключаемость**  
   Каждый логический блок (GPS-запись, карта, рекомендации POI, UI-анимации и т. д.) выполняется в отдельном модуле/процессе; он может быть остановлен или выгружен без влияния на остальные.
3. **Динамический выбор критических задач**  
   «Наблюдатель» формирует белый список процессов, необходимых для текущего сценария (например, «запись трека в горах»), и приостанавливает остальное (рекомендации кафе, интенсивный рендеринг UI и т. п.).
4. **Калибровка нагрузки**  
   - Включать DVFS / CPU governor «powersave», устанавливать минимально допустимую частоту.  
   - Сводить I/O к минимуму: пакетная запись в БД, отложенные синхронизации.  
   - Если устройство поддерживает LTPO, снижать частоту обновления экрана до 1 – 10 Гц на статичных сценах.
5. **Плавный переход между режимами**  
   При переключении пользователя на функционально «тяжёлый» модуль «наблюдатель» выводит предупреждение о возможной задержке (cold-start до 3 с) и отслеживает успешное завершение выгрузки старых процессов.